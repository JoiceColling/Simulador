{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <h2>Simulação Randômica</h2>
    <div class="mb-3">
        <label for="num_simulations" class="form-label">Número de Simulações:</label>
        <input type="number" id="num_simulations" class="form-control" value="1" min="1">
        <label for="num_simulations" class="form-label">Número de Funcionários:</label>
        <input type="number" id="num_funcionarios" class="form-control" value="1" min="1">

    </div>

    <div class="mb-3">
        <button id="startSimulation" class="btn btn-primary me-3">Iniciar Simulação Randômica</button>
        <button id="stopSimulation" class="btn btn-danger">Parar Simulação Randômica</button>
    </div>

    <div id="simulationResults">
        <ul id="simulationList" class="list-group"></ul>
    </div>
</div>

<script>
    $(document).ready(function() {
        var socket = io();

        // Função para iniciar a simulação randômica ao clicar no botão
        $('#startSimulation').click(function() {
            $('#simulationList').empty();  // Limpa a lista de resultados

            var numSimulations = $('#num_simulations').val();  // Obtém o número de simulações
            var numFuncionarios = $('#num_funcionarios').val();
            socket.emit('start_random_simulation', { num_simulations: numSimulations, num_funcionarios:numFuncionarios });  // Envia para o servidor via Socket.IO
        });

        // Função para parar a simulação randômica ao clicar no botão
        $('#stopSimulation').click(function() {
            socket.emit('stop_random_simulation');  // Envia para o servidor via Socket.IO
        });

        // Recebe atualizações de progresso da simulação randômica
        socket.on('random_simulation_update', function(data) {
            var os_name = data.os_name;
            var item = $('#' + os_name.replace(':', '\\:'));

            if (item.length === 0) {
                var statusClass = data.status === 'in_progress' ? 'list-group-item list-group-item-warning' : 'list-group-item';
                if (data.status === 'pending') {
                    statusClass = 'list-group-item list-group-item-danger';
                }
                $('#simulationList').append('<li id="' + os_name + '" class="' + statusClass + '">' + os_name + ' - Chegada: ' + data.chegada + ', Serviço: ' + data.servico + ' - Status: ' + data.status + '</li>');
            } else {
                var statusText = os_name + ' - Chegada: ' + data.chegada + ', Serviço: ' + data.servico + ' - Status: ' + data.status;
                if (data.status === 'in_progress') {
                    statusText += ', Funcionário: ' + data.funcionario;  // Adiciona o nome do funcionário
                }
                item.text(statusText);
                item.removeClass('list-group-item-success list-group-item-info list-group-item-warning list-group-item-danger');  // Limpa classes anteriores
                if (data.status === 'completed') {
                    item.addClass('list-group-item-success');  // Estilo para simulação concluída
                } else if (data.status === 'in_progress') {
                    item.addClass('list-group-item-warning');  // Estilo para simulação em progresso
                } else if (data.status === 'pending') {
                    item.addClass('list-group-item-danger');  // Estilo para simulação pendente
                }
            }
        });

        // Recebe mensagem de conclusão da simulação randômica
        socket.on('random_simulation_complete', function(data) {
            $('#simulationList').append('<li class="list-group-item list-group-item-success">' + data.message + '</li>');
        });

        // Recebe mensagem de erro da simulação randômica
        socket.on('random_simulation_error', function(data) {
            alert(data.error);
        });
    });
</script>

{% endblock %}
